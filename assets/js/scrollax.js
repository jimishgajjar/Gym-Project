(function(factory){'use strict';if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports!=='undefined'){module.exports=factory(require('jquery'));}else{factory(jQuery);}}(function($){'use strict';var ArrayProto=Array.prototype,ObjProto=Object.prototype,push=ArrayProto.push,splice=ArrayProto.splice,hasOwnProperty=ObjProto.hasOwnProperty,namespace='Scrollax',lownamespace=namespace.toLowerCase(),numberRegExp=/[-+]?\d+(\.\d+)?/g,transforms=['translateX','translateY','rotate','rotateX','rotateY','rotateZ','skewX','skewY','scaleX','scaleY'],$win=$(window),$doc=$(document.body),transform,gpuAcceleration,position,bind,unbind;var Scrollax=function(frame,options,callbackMap){var self=this;var $frame=frame&&$(frame).eq(0)||$win;var instances=Scrollax.instances;var prevent=null;frame=$frame[0];$.each(instances,function(instance,i){if(instance&&instance.frame===frame){prevent=true;}});if(!frame||prevent){if(prevent){warn(namespace+': Scrollax has been initialized for this frame!');}
else{warn(namespace+': Frame is not available!');}
return;}
var o=$.extend({},Scrollax.defaults,options);var parents=[],$parents=null,parentSelector=o.parentSelector||'[data-'+lownamespace+'-parent]',elementsSelector=o.elementsSelector||'[data-'+lownamespace+']',callbacks={},tmpArray=[],resizeID,frameIsWindow=isWindow(frame),i,l,pi,pl,$freezer,timer,containsPerformanceClass,offset,isHorizontal,parentOffset,pos,parent,parentOptions,ratio,start,end,parallaxElements,parallaxable,el,properties,property,value,transformStyle,numbers;self.frame=frame;self.options=o;self.parents=parents;self.initialized=false;function load(){$parents=frameIsWindow?$doc.find(parentSelector):$frame.find(parentSelector);parents.length=0;isHorizontal=!!o.horizontal;$parents.each(parentEachHandler);scrollHandler();if(o.performanceTrick){$freezer=frameIsWindow?$doc:$frame;}
trigger('load');return self;}
self.reload=load;var parentEachHandler=function(i,element){var $parent=$(element),parentOptions=getInlineOptions($(element)),parent={};parent.element=element,parent.options=parentOptions,parent.parallaxElements=[];$parent.find(elementsSelector).each(function(pI,pElement){var parallaxElement=getInlineOptions($(pElement));parallaxElement.element=pElement;push.call(parent.parallaxElements,parallaxElement);});push.call(parents,parent);}
function resizeHandler(){if(resizeID){resizeID=clearTimeout(resizeID);}
resizeID=setTimeout(function(){self.reload();});};function scrollHandler(){var l=parents.length;if(o.performanceTrick&&$freezer){clearTimeout(timer);if(!containsPerformanceClass){$freezer.addClass('scrollax-performance');containsPerformanceClass=true;}
timer=setTimeout(function(){$freezer.removeClass('scrollax-performance');containsPerformanceClass=false;},100);}
if(!l){return;}
offset=getOffset(frame);for(var i=0;i<l;i++){parent=parents[i];pos=position(parent.element,frame);if(pos[isHorizontal?'right':'bottom']<0||pos[isHorizontal?'left':'top']>offset[isHorizontal?'width':'height']){continue;}
parentOptions=parent.options;parentOffset=parentOptions.offset||o.offset||0;start=pos[isHorizontal?'right':'bottom'];end=pos[isHorizontal?'width':'height'];ratio=(end-start+parentOffset)/end;if(ratio<0){start=pos[isHorizontal?'left':'top'];end=offset[isHorizontal?'width':'height'];ratio=-1+(end-start+parentOffset)/end;}
if(ratio>1||ratio<-1){continue;}
parallax(parent,ratio,isHorizontal);}
trigger('scroll',offset);}
self.scroll=scrollHandler;function parallax(parent,ratio){parallaxElements=parent.parallaxElements;var l=parallaxElements.length;if(!l){return;}
for(var i=0;i<l;i++){parallaxable=parallaxElements[i];el=parallaxable.element;styleHandler(el,parallaxable,ratio);}}
function styleHandler(element,parallaxable,ratio){properties=parallaxable.properties||(isHorizontal?{'translateX':'100%'}:{'translateY':'100%'});transformStyle="";for(property in properties){value=properties[property];if(typeof value==='number'){value=value*ratio;}
else if(typeof value==='string'){numbers=value.match(numberRegExp);value=value;for(i=0,l=numbers.length;i<l;i++){value=value.replace(numbers[i],parseFloat(numbers[i]*ratio));};}
if($.inArray(property,transforms)!==-1){transformStyle+=property+'('+value+')';}
else{element.style[property]=property==='opacity'?within(ratio<0?1+value:1-value,0,1):value;}}
if(transformStyle){element.style[transform]=gpuAcceleration+transformStyle;}}
function getIndex(parent){return typeof parent!=='undefined'?is_numeric(parent)?parent>=0&&parent<parents.length?parent:-1:$parents.index(parent):-1;}
self.getIndex=getIndex;function trigger(name,arg1){if(callbacks[name]){l=callbacks[name].length;tmpArray.length=0;for(i=0;i<l;i++){push.call(tmpArray,callbacks[name][i]);}
for(i=0;i<l;i++){tmpArray[i].call(self,name,arg1);}}}
self.one=function(name,fn){function proxy(){fn.apply(self,arguments);self.off(name,proxy);}
self.on(name,proxy);return self;};self.on=function(name,fn){if(typeof(name)==='object'){for(var key in name){if(hasOwnProperty.call(name,key)){self.on(key,name[key]);}}}
else if(typeof(fn)==='function'){var names=name.split(' ');for(var n=0,nl=names.length;n<nl;n++){callbacks[names[n]]=callbacks[names[n]]||[];if(callbackIndex(names[n],fn)===-1){push.call(callbacks[names[n]],fn);}}}
else if(typeof(fn)==='array'){for(var f=0,fl=fn.length;f<fl;f++){self.on(name,fn[f]);}}
return self;};self.off=function(name,fn){if(fn instanceof Array){for(var f=0,fl=fn.length;f<fl;f++){self.off(name,fn[f]);}}
else{var names=name.split(' ');for(var n=0,nl=names.length;n<nl;n++){callbacks[names[n]]=callbacks[names[n]]||[];if(typeof(fn)==='undefined'){callbacks[names[n]].length=0;}
else{var index=callbackIndex(names[n],fn);if(index!==-1){splice.call(callbacks[names[n]],index,1);}}}}
return self;};function callbackIndex(name,fn){for(var i=0,l=callbacks[name].length;i<l;i++){if(callbacks[name][i]===fn){return i;}}
return-1;}
self.set=function(name,value){if($.isPlainObject(name)){$.extend(o,name);}
else if(hasOwnProperty.call(o,name)){o[name]=value;}
load();return self;};self.destroy=function(){unbind(window,'resize',resizeHandler);unbind(frame,'scroll',scrollHandler);$.each(instances,function(instance,i){if(instance&&instance.frame===frame){splice.call(Scrollax.instances,i,1);}});parents.length=0;self.initialized=false;trigger('destroy');return self;};self.init=function(){if(self.initialized){return;}
self.on(callbackMap);load();bind(window,'resize',resizeHandler);bind(frame,'scroll',scrollHandler);push.call(Scrollax.instances,self);self.initialized=true;trigger('initialized');return self;};};Scrollax.instances=[];function warn(message){if(console&&console.warn){console.warn(namespace+': '+message);}
else{throw(namespace+': '+message);}}
function getOffset(element){var isWin=!!('pageYOffset'in element);return{width:isWin?(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth):element.offsetWidth,height:isWin?(window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight):element.offsetHeight,left:element[isWin?'pageXOffset':'scrollLeft'],top:element[isWin?'pageYOffset':'scrollTop']};}
function is_numeric(value){return(typeof(value)==='number'||typeof(value)==='string')&&value!==''&&!isNaN(value);}
function within(number,min,max){return number<min?min:number>max?max:number;}
function getInlineOptions($element){var data=$element.data(lownamespace.toLowerCase());return data&&eval("({"+data+"})")||{};}
function isWindow(val){var doc,docWin;return!!(val&&typeof val==='object'&&typeof val.window==='object'&&val.window==val&&val.setTimeout&&val.alert&&(doc=val.document)&&typeof doc==='object'&&(docWin=doc.defaultView||doc.parentWindow)&&typeof docWin==='object'&&docWin==val);};(function(){var k,doc,docEl,win,winTop,winLeft,box,relBox;function extend(a,b){for(k in b)a[k]=b[k];return a;}
position=function(element,relativeTo){doc=element.ownerDocument||element;docEl=doc.documentElement;win=isWindow(relativeTo)?relativeTo:doc.defaultView||window;relativeTo=!relativeTo||relativeTo===doc?docEl:relativeTo;winTop=(win.pageYOffset||docEl.scrollTop)-docEl.clientTop;winLeft=(win.pageXOffset||docEl.scrollLeft)-docEl.clientLeft;box={top:0,left:0};if(element&&element.getBoundingClientRect){box=extend({},element.getBoundingClientRect());box.width=box.right-box.left;box.height=box.bottom-box.top;}else{return null;}
if(relativeTo===win)return box;box.top+=winTop;box.left+=winLeft;box.right+=winLeft;box.bottom+=winTop;if(relativeTo===docEl)return box;relBox=position(relativeTo);box.left-=relBox.left;box.right-=relBox.left;box.top-=relBox.top;box.bottom-=relBox.top;return box;}}());(function(){function preventDefault(){this.returnValue=false;}
function stopPropagation(){this.cancelBubble=true;}
bind=window.addEventListener?function(el,type,fn,capture){el.addEventListener(type,fn,capture||false);return fn;}:function(el,type,fn){var fnid=type+fn;el[fnid]=el[fnid]||function(){var event=window.event;event.target=event.srcElement;event.preventDefault=preventDefault;event.stopPropagation=stopPropagation;fn.call(el,event);};el.attachEvent('on'+type,el[fnid]);return fn;};unbind=window.removeEventListener?function(el,type,fn,capture){el.removeEventListener(type,fn,capture||false);return fn;}:function(el,type,fn){var fnid=type+fn;el.detachEvent('on'+type,el[fnid]);try{delete el[fnid];}catch(err){el[fnid]=undefined;}
return fn;};}());(function(){var prefixes=['','webkit','moz','ms','o'];var el=document.createElement('div');function testProp(prop){for(var p=0,pl=prefixes.length;p<pl;p++){var prefixedProp=prefixes[p]?prefixes[p]+prop.charAt(0).toUpperCase()+prop.slice(1):prop;if(el.style[prefixedProp]!=null){return prefixedProp;}}}
transform=testProp('transform');gpuAcceleration=testProp('perspective')?'translateZ(0) ':'';}());Scrollax.defaults={horizontal:false,offset:0,parentSelector:null,elementsSelector:null,performanceTrick:false};window.Scrollax=Scrollax;$.fn.Scrollax=function(options,callbackMap){var method,methodArgs;if(!$.isPlainObject(options)){if(typeof options==='string'||options===false){method=options===false?'destroy':options;methodArgs=slice.call(arguments,1);}
options={};}
return this.each(function(i,element){var plugin=$.data(element,lownamespace);if(!plugin&&!method){plugin=$.data(element,lownamespace,new Scrollax(element,options,callbackMap).init());}
else if(plugin&&method){if(plugin[method]){plugin[method].apply(plugin,methodArgs);}}});};$.Scrollax=function(options,callbackMap){$win.Scrollax(options,callbackMap);};var css='.scrollax-performance, .scrollax-performance *, .scrollax-performance *:before, .scrollax-performance *:after { pointer-events: none !important; -webkit-animation-play-state: paused !important; animation-play-state: paused !important; };',head=document.head||document.getElementsByTagName('head')[0],style=document.createElement('style');style.type='text/css';if(style.styleSheet){style.styleSheet.cssText=css;}else{style.appendChild(document.createTextNode(css));}
head.appendChild(style);return Scrollax;}));